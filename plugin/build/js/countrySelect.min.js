!function(a){"function"==typeof define&&define.amd?define(["jquery"],function(b){a(b,window,document)}):a(jQuery,window,document)}(function(a,b,c,d){"use strict";function j(b,c){this.element=b,this.options=a.extend({},g,c),this._defaults=g,this.ns="."+e+f++,this._name=e,this.init()}var e="countrySelect",f=1,g={defaultCountry:"",defaultStyling:"inside",onlyCountries:[],preferredCountries:["us","gb"]},h={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90},i=!1;a(b).load(function(){i=!0}),j.prototype={init:function(){this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners()},_processCountryData:function(){this._setInstanceCountryData(),this._setPreferredCountries()},_setInstanceCountryData:function(){var b=this;if(this.options.onlyCountries.length){var c=[];a.each(this.options.onlyCountries,function(a,d){var e=b._getCountryData(d,!0);e&&c.push(e)}),this.countries=c}else this.countries=k},_setPreferredCountries:function(){var b=this;this.preferredCountries=[],a.each(this.options.preferredCountries,function(a,c){var d=b._getCountryData(c,!1);d&&b.preferredCountries.push(d)})},_generateMarkup:function(){this.countryInput=a(this.element);var b="country-select";this.options.defaultStyling&&(b+=" "+this.options.defaultStyling),this.countryInput.wrap(a("<div>",{"class":b}));var c=a("<div>",{"class":"flag-dropdown"}).insertAfter(this.countryInput),d=a("<div>",{"class":"selected-flag"}).appendTo(c);this.selectedFlagInner=a("<div>",{"class":"flag"}).appendTo(d),a("<div>",{"class":"arrow"}).appendTo(this.selectedFlagInner),this.countryList=a("<ul>",{"class":"country-list v-hide"}).appendTo(c),this.preferredCountries.length&&(this._appendListItems(this.preferredCountries,"preferred"),a("<li>",{"class":"divider"}).appendTo(this.countryList)),this._appendListItems(this.countries,""),this.countryCodeInput=a("#"+this.countryInput.attr("id")+"_code"),this.countryCodeInput||(this.countryCodeInput=a('<input type="hidden" id="'+this.countryInput.attr("id")+'_code" name="'+this.countryInput.attr("name")+'_code" value="" />'),this.countryCodeInput.insertAfter(this.countryInput)),this.dropdownHeight=this.countryList.outerHeight(),this.countryList.removeClass("v-hide").addClass("hide"),this.countryListItems=this.countryList.children(".country")},_appendListItems:function(b,c){var d="";a.each(b,function(a,b){d+='<li class="country '+c+'" data-country-code="'+b.iso2+'">',d+='<div class="flag '+b.iso2+'"></div>',d+='<span class="country-name">'+b.name+"</span>",d+="</li>"}),this.countryList.append(d)},_setInitialState:function(){var a=!1;this.countryInput.val()&&(a=this._updateFlagFromInputVal());var b=this.countryCodeInput.val();if(b&&this.selectCountry(b),!a){var c;this.options.defaultCountry?(c=this._getCountryData(this.options.defaultCountry,!1),c||(c=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0])):c=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0],this.selectCountry(c.iso2)}},_initListeners:function(){var a=this;this.countryInput.on("keyup"+this.ns,function(){a._updateFlagFromInputVal()});var b=this.selectedFlagInner.parent();b.on("click"+this.ns,function(){a.countryList.hasClass("hide")&&!a.countryInput.prop("disabled")&&a._showDropdown()})},_focus:function(){this.countryInput.focus();var a=this.countryInput[0];if(a.setSelectionRange){var b=this.countryInput.val().length;a.setSelectionRange(b,b)}},_showDropdown:function(){this._setDropdownPosition();var a=this.countryList.children(".active");this._highlightListItem(a),this.countryList.removeClass("hide"),this._scrollTo(a),this._bindDropdownListeners(),this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var c=this.countryInput.offset().top,d=a(b).scrollTop(),e=c+this.countryInput.outerHeight()+this.dropdownHeight<d+a(b).height(),f=c-this.dropdownHeight>d,g=!e&&f?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",g)},_bindDropdownListeners:function(){var b=this;this.countryList.on("mouseover"+this.ns,".country",function(){b._highlightListItem(a(this))}),this.countryList.on("click"+this.ns,".country",function(){b._selectListItem(a(this))});var d=!0;a("html").on("click"+this.ns,function(){d||b._closeDropdown(),d=!1}),a(c).on("keydown"+this.ns,function(a){a.preventDefault(),a.which==h.UP||a.which==h.DOWN?b._handleUpDownKey(a.which):a.which==h.ENTER?b._handleEnterKey():a.which==h.ESC?b._closeDropdown():a.which>=h.A&&a.which<=h.Z&&b._handleLetterKey(a.which)})},_handleUpDownKey:function(a){var b=this.countryList.children(".highlight").first(),c=a==h.UP?b.prev():b.next();c.length&&(c.hasClass("divider")&&(c=a==h.UP?c.prev():c.next()),this._highlightListItem(c),this._scrollTo(c))},_handleEnterKey:function(){var a=this.countryList.children(".highlight").first();a.length&&this._selectListItem(a)},_handleLetterKey:function(b){var c=String.fromCharCode(b),d=this.countryListItems.filter(function(){return a(this).text().charAt(0)==c&&!a(this).hasClass("preferred")});if(d.length){var f,e=d.filter(".highlight").first();f=e&&e.next()&&e.next().text().charAt(0)==c?e.next():d.first(),this._highlightListItem(f),this._scrollTo(f)}},_updateFlagFromInputVal:function(){var b=this,c=this.countryInput.val().replace(/(?=[() ])/g,"\\");if(c){for(var d=[],e=new RegExp("^"+c,"i"),f=0;f<this.countries.length;f++)this.countries[f].name.match(e)&&d.push(this.countries[f].iso2);var g=!1;return a.each(d,function(a,c){b.selectedFlagInner.hasClass(c)&&(g=!0)}),g||(this._selectFlag(d[0]),this.countryCodeInput.val(d[0]).trigger("change")),!0}return!1},_highlightListItem:function(a){this.countryListItems.removeClass("highlight"),a.addClass("highlight")},_getCountryData:function(a,b){for(var c=b?k:this.countries,d=0;d<c.length;d++)if(c[d].iso2==a)return c[d];return null},_selectFlag:function(a){if(!a)return!1;this.selectedFlagInner.attr("class","flag "+a);var b=this._getCountryData(a);this.selectedFlagInner.parent().attr("title",b.name);var c=this.countryListItems.children(".flag."+a).first().parent();this.countryListItems.removeClass("active"),c.addClass("active")},_selectListItem:function(a){var b=a.attr("data-country-code");this._selectFlag(b),this._closeDropdown(),this._updateName(b),this.countryInput.trigger("change"),this.countryCodeInput.trigger("change"),this._focus()},_closeDropdown:function(){this.countryList.addClass("hide"),this.selectedFlagInner.children(".arrow").removeClass("up"),a(c).off("keydown"+this.ns),a("html").off("click"+this.ns),this.countryList.off(this.ns)},_scrollTo:function(a){if(a&&a.offset()){var b=this.countryList,c=b.height(),d=b.offset().top,e=d+c,f=a.outerHeight(),g=a.offset().top,h=g+f,i=g-d+b.scrollTop();if(d>g)b.scrollTop(i);else if(h>e){var j=c-f;b.scrollTop(i-j)}}},_updateName:function(a){this.countryCodeInput.val(a).trigger("change"),this.countryInput.val(this._getCountryData(a).name)},getSelectedCountryData:function(){var a=this.selectedFlagInner.attr("class").split(" ")[1];return this._getCountryData(a)},selectCountry:function(a){this.selectedFlagInner.hasClass(a)||(this._selectFlag(a),this._updateName(a))},setCountry:function(a){this.countryInput.val(a),this._updateFlagFromInputVal()},destroy:function(){this.countryInput.off(this.ns),this.selectedFlagInner.parent().off(this.ns);var a=this.countryInput.parent();a.before(this.countryInput).remove()}},a.fn[e]=function(b){var c=arguments;if(b===d||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+e)||a.data(this,"plugin_"+e,new j(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var f;return this.each(function(){var d=a.data(this,"plugin_"+e);d instanceof j&&"function"==typeof d[b]&&(f=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+e,null)}),f!==d?f:this}},a.fn[e].getCountryData=function(){return k},a.fn[e].setCountryData=function(a){k=a};var k=a.each([{n:"Afghanistan",i:"af"},{n:"Albania",i:"al"},{n:"Algeria",i:"dz"},{n:"Angola",i:"ao"},{n:"Argentina",i:"ar"},{n:"Armenia",i:"am"},{n:"Australia",i:"au"},{n:"Austria",i:"at"},{n:"Azerbaijan",i:"az"},{n:"Bahamas",i:"bs"},{n:"Bangladesh",i:"bd"},{n:"Belarus",i:"by"},{n:"Belgium",i:"be"},{n:"Belize",i:"bz"},{n:"Benin",i:"bj"},{n:"Bhutan",i:"bt"},{n:"Bolivia",i:"bo"},{n:"Bosnia and Herzegovina",i:"ba"},{n:"Botswana",i:"bw"},{n:"Brazil",i:"br"},{n:"Bulgaria",i:"bg"},{n:"Burkina Faso",i:"bf"},{n:"Burundi",i:"bi"},{n:"Cambodia",i:"kh"},{n:"Cameroon",i:"cm"},{n:"Canada",i:"ca"},{n:"Chad",i:"td"},{n:"Chile",i:"cl"},{n:"China",i:"cn"},{n:"Colombia",i:"co"},{n:"Congo",i:"cd"},{n:"Costa Rica",i:"cr"},{n:"Croatia",i:"hr"},{n:"Cuba",i:"cu"},{n:"Cyprus",i:"cy"},{n:"Czech Republic",i:"cz"},{n:"Denmark",i:"dk"},{n:"Djibouti",i:"dj"},{n:"Dominican Republic",i:"do"},{n:"Ecuador",i:"ec"},{n:"Egypt",i:"eg"},{n:"El Salvador",i:"sv"},{n:"Equatorial Guinea",i:"gq"},{n:"Estonia",i:"ee"},{n:"Ethiopia",i:"et"},{n:"Falkland Islands",i:"fk"},{n:"Faroe Islands",i:"fo"},{n:"Fiji",i:"fj"},{n:"Finland",i:"fi"},{n:"France",i:"fr"},{n:"French Guiana)",i:"gf"},{n:"Gabon",i:"ga"},{n:"Georgia",i:"ge"},{n:"Germany",i:"de"},{n:"Ghana",i:"gh"},{n:"Greece",i:"gr"},{n:"Greenland",i:"gl"},{n:"Guinea",i:"gn"},{n:"Guinea-Bissau",i:"gw"},{n:"Guyana",i:"gy"},{n:"Haiti",i:"ht"},{n:"Honduras",i:"hn"},{n:"Hungary",i:"hu"},{n:"Iceland",i:"is"},{n:"India",i:"in"},{n:"Indonesia",i:"id"},{n:"Iran",i:"ir"},{n:"Iraq",i:"iq"},{n:"Ireland",i:"ie"},{n:"Israel",i:"il"},{n:"Italy",i:"it"},{n:"Jamaica",i:"jm"},{n:"Japan",i:"jp"},{n:"Jordan",i:"jo"},{n:"Kazakhstan",i:"kz"},{n:"Kenya",i:"ke"},{n:"Kosovo",i:"xk"},{n:"Kuwait",i:"kw"},{n:"Kyrgyzstan",i:"kg"},{n:"Laos",i:"la"},{n:"Latvia",i:"lv"},{n:"Lebanon",i:"lb"},{n:"Liberia",i:"lr"},{n:"Libya",i:"ly"},{n:"Lithuania",i:"lt"},{n:"Luxembourg",i:"lu"},{n:"Macedonia",i:"mk"},{n:"Madagascar",i:"mg"},{n:"Malawi",i:"mw"},{n:"Malaysia",i:"my"},{n:"Mali",i:"ml"},{n:"Mauritania",i:"mr"},{n:"Mexico",i:"mx"},{n:"Moldova",i:"md"},{n:"Mongolia",i:"mn"},{n:"Montenegro",i:"me"},{n:"Morocco",i:"ma"},{n:"Mozambique",i:"mz"},{n:"Myanmar (Burma)",i:"mm"},{n:"Namibia",i:"na"},{n:"Nepal",i:"np"},{n:"Netherlands",i:"nl"},{n:"New Caledonia",i:"nc"},{n:"New Zealand",i:"nz"},{n:"Nicaragua",i:"ni"},{n:"Nigeria",i:"ng"},{n:"North Korea",i:"kp"},{n:"Norway",i:"no"},{n:"Oman",i:"om"},{n:"Pakistan",i:"pk"},{n:"Panama",i:"pa"},{n:"Papua New Guinea",i:"pg"},{n:"Paraguay",i:"py"},{n:"Peru",i:"pe"},{n:"Philippines",i:"ph"},{n:"Poland",i:"pl"},{n:"Portugal",i:"pt"},{n:"Puerto Rico",i:"pr"},{n:"Qatar",i:"qa"},{n:"Romania",i:"ro"},{n:"Russia",i:"ru"},{n:"Rwanda",i:"rw"},{n:"Saudi Arabia",i:"sa"},{n:"Senegal",i:"sn"},{n:"Serbia",i:"rs"},{n:"Sierra Leone",i:"sl"},{n:"Slovakia",i:"sk"},{n:"Slovenia",i:"si"},{n:"Solomon Islands",i:"sb"},{n:"Somalia",i:"so"},{n:"South Africa",i:"za"},{n:"South Korea",i:"kr"},{n:"South Sudan",i:"ss"},{n:"Spain",i:"es"},{n:"Sri Lanka",i:"lk"},{n:"Sudan",i:"sd"},{n:"Suriname",i:"sr"},{n:"Svalbard and Jan Mayen",i:"sj"},{n:"Sweden (Sverige)",i:"se"},{n:"Switzerland",i:"ch"},{n:"Syria",i:"sy"},{n:"Taiwan",i:"tw"},{n:"Tajikistan",i:"tj"},{n:"Tanzania",i:"tz"},{n:"Thailand",i:"th"},{n:"Timor-Leste",i:"tl"},{n:"Togo",i:"tg"},{n:"Trinidad and Tobago",i:"tt"},{n:"Tunisia",i:"tn"},{n:"Turkey",i:"tr"},{n:"Uganda",i:"ug"},{n:"Ukraine",i:"ua"},{n:"United Arab Emirates",i:"ae"},{n:"United Kingdom",i:"gb"},{n:"United States",i:"us"},{n:"Uruguay",i:"uy"},{n:"Uzbekistan",i:"uz"},{n:"Vanuatu",i:"vu"},{n:"Venezuela",i:"ve"},{n:"Vietnam",i:"vn"},{n:"Western Sahara",i:"eh"},{n:"Yemen",i:"ye"},{n:"Zambia",i:"zm"}],function(a,b){b.name=b.n,b.iso2=b.i,delete b.n,delete b.i})});